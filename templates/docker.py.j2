#!/usr/bin/env python

import json
import os
import re
import subprocess
import sys

def lowerDict(d):
    """Convert all dict keys into lower case
    """
    if isinstance(d, dict):
        return {k.lower(): lowerDict(v) for k, v in d.items()}
    return d

content=dict()

env=dict({
  'DOCKER_HOST': '{{ docker_server__host }}'
})

try:
    result = subprocess.Popen(['/usr/bin/env', 'docker', 'version', '--format', '{{ '{{' }}json .{{ '}}' }}'], stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=True)
    (stdout, stderr) = result.communicate()
    version = json.loads(stdout)
    content = lowerDict(version)
except subprocess.CalledProcessError as e:
    content['error'] = str(e)
except json.decoder.JSONDecodeError as ej:
    content['error'] = 'Bad Json : ' + str(ej)

if len(content) == 0:
    content = None

print(json.dumps(content))
sys.exit(0)
